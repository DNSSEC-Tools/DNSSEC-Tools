#!/usr/bin/perl

use strict;

my $detail = $ENV{'LOGWATCH_DETAIL_LEVEL'};
my $daterange = $ENV{'LOGWATCH_DATE_RANGE'};
my $tempdir = $ENV{'LOGWATCH_TEMP_DIR'};
my $debuglevel = $ENV{'LOGWATCH_DEBUG'};

my $valComplete;
my $valOK;
my $nonextValOK;

while (defined(my $ThisLine = <STDIN>)) {
   if ($ThisLine =~ /validation completion event/) {
      $valComplete++;
   } elsif ($ThisLine =~ /nonexistence validation OK/) {
      $nonextValOK++;
   } elsif ($ThisLine =~ /validation OK/) {
      $valOK++;
   } 
}

if ($detail >= 5) {
   my %msgHash = ();
   print "\n";
   if ($valComplete > 0) {
      $msgHash{"Received validation completion event "} = $valComplete;
   }
   if ($nonextValOK > 0) {
      $msgHash{"Nonexistence validation OK received "} = $nonextValOK;
   }
   if ($valOK > 0) {
      $msgHash{"Validation OK "} = $valOK;
   }

# sort all the non-zero message types and print them in descending order
# of number of occurrences
   my $key;
   foreach $key (sort { $msgHash{$b} <=> $msgHash{$a} } keys %msgHash) {
      print "   " . $key . " " . $msgHash{$key} . " times\n";
   }
}

exit (0);

# vi: shiftwidth=3 tabstop=3 et

