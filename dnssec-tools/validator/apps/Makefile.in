
LIBS=@LIBS@
INCL= ../include
LIB= ../include
CFLAGS_EX=-I$(INCL) -I.. -I../libsres -I../libval
LOCALLIBS=../libval/libval$(LIBVAL_SUFFIX).la ../libsres/libsres.la
LDFLAGS_EX=$(LOCALLIBS) $(EXTRALIBS)

SRC=  	val_resquery.c \
	crypto/val_dsasha1.c

# can't use gmake conventions to translate SRC -> OBJ for portability
VAL_OBJ= validator_driver.o \
	validator_selftest.o 
VAL_LOBJ= validator_driver.lo \
	validator_selftest.lo

ALL_OBJ= $(VAL_OBJ) \
	getaddr.o \
	gethost.o

ALL_LOBJ= $(VAL_LOBJ) \
	getaddr.lo \
	gethost.lo

VALIDATOR=validate
GETHOST=gethost
GETADDR=getaddr

all: $(VALIDATOR) $(GETHOST) $(GETADDR)

clean:
	$(RM) -f $(ALL_LOBJ) $(ALL_OBJ) $(VALIDATOR) $(GETHOST) $(GETADDR)

$(VALIDATOR): $(VAL_OBJ) $(LOCALLIBS)
	$(LIBTOOLLD) -o $@ $(VAL_OBJ) $(LDFLAGS) $(LIBS)

$(GETHOST): gethost.lo $(LOCALLIBS)
	$(LIBTOOLLD) -o $@ gethost.lo $(LDFLAGS) $(LIBS)

$(GETADDR): getaddr.lo $(LOCALLIBS)
	$(LIBTOOLLD) -o $@ getaddr.lo $(LDFLAGS) $(LIBS)

install:
	$(MKPATH) $(bindir)
	$(LIBTOOLIN) $(VALIDATOR) $(bindir)	
	$(LIBTOOLIN) $(GETHOST) $(bindir)	
	$(LIBTOOLIN) $(GETADDR) $(bindir)	
	$(MKPATH) $(prefix)/etc/dnssec
	$(CP) selftests.dist @VALIDATOR_TESTCASES@
