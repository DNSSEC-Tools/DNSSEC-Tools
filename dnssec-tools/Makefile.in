PERLDIRS=tools/modules tools/donuts tools/mapper tools/scripts \
         tools/dnspktflow tools/maketestzone tools/etc tools/drawvalmap
PERLARGS=@PERLARGS@
SUBDIRS=validator
INSTALLDIRS=$(prefix) $(exec_prefix) $(bindir) $(sbindir) $(libdir) $(datadir) $(includedir) $(mandir) $(man1dir) $(man3dir) $(man5dir) $(man8dir)		

all: makeit

libs: subdirmake

makeit: perlmakefiles perlmake subdirmake

install: makedirectories perlinstall subdirinstall nextstepinstructions

clean: perlclean subdirclean

distclean: clean configclean

nextstepinstructions:
	@echo ""
	@echo "**********************************************************************"
	@echo "** NEXT: Please run 'dtinitconf' in order to set up the required"
	@echo "**       $(prefix)/etc/dnssec/dnssec-tools.conf file"
	@echo "**********************************************************************"
	@echo ""

makedirectories:
	@for i in $(INSTALLDIRS) ; do \
		if test ! -d $$i ; then \
			echo "creating directory $$i/" \
			$(MKPATH) $$I ; \
		fi \
	done
#
# Subdir build rules
#

subdirmake:
	@for i in $(SUBDIRS) ; do \
	  (cd $$i ; make ) ; \
	  if test $$? != 0 ; then \
	     exit 1 ; \
	  fi  \
         done

subdirinstall:
	@for i in $(SUBDIRS) ; do \
	  (cd $$i ; make install ) ; \
	  if test $$? != 0 ; then \
	     exit 1 ; \
	  fi  \
         done

subdirclean:
	@for i in $(SUBDIRS) ; do \
	  (cd $$i ; make clean ) ; \
         done

#
# Perl system build rules
#

perlmake:
	@for i in $(PERLDIRS) ; do \
	  (cd $$i ; make ) ; \
	  if test $$? != 0 ; then \
	     exit 1 ; \
	  fi  \
         done

perlmakefiles:
	@for i in $(PERLDIRS) ; do \
	  if test ! -f $$i/Makefile ; then \
	    (cd $$i ; perl Makefile.PL $(PERLARGS)) ; \
          fi ; \
         done

perlinstall:
	@for i in $(PERLDIRS) ; do \
	  (cd $$i ; make install ) ; \
	  if test $$? != 0 ; then \
	     exit 1 ; \
	  fi  \
         done

perlclean:
	@for i in $(PERLDIRS) ; do \
	  (cd $$i ; make clean ) ; \
         done

#
# Config system rules
#

configclean:
	rm -f config.cache config.status config.log \
		Makefile stamp-h *.core
