<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Net::DNS::SEC::Tools::keyrec - DNSSEC-Tools I&lt;keyrec&gt; file operations</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:tewok@leodhas.local" />
</head>

<body style="background-color: white">


<!-- INDEX BEGIN -->
<div name="index">
<p><a name="__index__"></a></p>

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<li><a href="#keyrec_interfaces">KEYREC INTERFACES</a></li>
	<li><a href="#keyrec_signing_set_interfaces">KEYREC SIGNING-SET INTERFACES</a></li>
	<li><a href="#keyrec_internal_interfaces">KEYREC INTERNAL INTERFACES</a></li>
	<li><a href="#keyrec_debugging_interfaces">KEYREC DEBUGGING INTERFACES</a></li>
	<li><a href="#copyright">COPYRIGHT</a></li>
	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
</ul>

<hr name="index" />
</div>
<!-- INDEX END -->

<p>
</p>
<hr />
<h1><a name="name">NAME</a></h1>
<p>Net::DNS::SEC::Tools::keyrec - DNSSEC-Tools <em>keyrec</em> file operations</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<pre>
  use Net::DNS::SEC::Tools::keyrec;</pre>
<pre>
  keyrec_creat(&quot;localzone.keyrec&quot;);
  keyrec_open(&quot;localzone.keyrec&quot;);  (DEPRECATED)
  $okfile = keyrec_filestat(&quot;localzone.keyrec&quot;);
  keyrec_read(&quot;localzone.keyrec&quot;);</pre>
<pre>
  @krnames = keyrec_names();</pre>
<pre>
  $krec = keyrec_fullrec(&quot;example.com&quot;);
  %keyhash = %$krec;
  $zname = $keyhash{&quot;algorithm&quot;};</pre>
<pre>
  $val = keyrec_recval(&quot;example.com&quot;,&quot;zonefile&quot;);</pre>
<pre>
  $exists = keyrec_exists(&quot;example.com&quot;);</pre>
<pre>
  keyrec_add(&quot;zone&quot;,&quot;example.com&quot;,\%zone_krfields);
  keyrec_add(&quot;key&quot;,&quot;Kexample.com.+005+12345&quot;,\%keydata);</pre>
<pre>
  keyrec_del(&quot;example.com&quot;);</pre>
<pre>
  keyrec_setval(&quot;zone&quot;,&quot;example.com&quot;,&quot;zonefile&quot;,&quot;db.example.com&quot;);</pre>
<pre>
  keyrec_delval(&quot;example.com&quot;,&quot;kskrev&quot;);</pre>
<pre>
  @kskpaths = keyrec_keypaths(&quot;example.com&quot;,&quot;kskcur&quot;);</pre>
<pre>
  $obsflag = keyrec_revoke_check(&quot;Kexample.com.+005+12345&quot;);</pre>
<pre>
  $setname = keyrec_signset_newname(&quot;example.com&quot;);</pre>
<pre>
  keyrec_signset_new($zone,&quot;example-set-21&quot;,&quot;zskcur&quot;);</pre>
<pre>
  keyrec_signset_addkey(&quot;example-keys&quot;,&quot;Kexample.com+005+12345&quot;,
                                         &quot;Kexample.com+005+54321&quot;);
  keyrec_signset_addkey(&quot;example-keys&quot;,@keylist);</pre>
<pre>
  keyrec_signset_delkey(&quot;example-keys&quot;,&quot;Kexample.com+005+12345&quot;);</pre>
<pre>
  $flag = keyrec_signset_haskey(&quot;example-keys&quot;,&quot;Kexample.com+005+12345&quot;);</pre>
<pre>
  keyrec_signset_clear(&quot;example-keys&quot;,&quot;Kexample.com+005+12345&quot;);</pre>
<pre>
  @signset = keyrec_signsets();</pre>
<pre>
  keyrec_settime(&quot;zone&quot;,&quot;example.com&quot;);
  keyrec_settime(&quot;set&quot;,&quot;signing-set-42&quot;);
  keyrec_settime(&quot;key&quot;,&quot;Kexample.com.+005+76543&quot;);</pre>
<pre>
  @keyfields = keyrec_keyfields();
  @zonefields = keyrec_zonefields();</pre>
<pre>
  keyrec_write();
  keyrec_saveas(&quot;filecopy.krf);
  keyrec_close();
  keyrec_discard();</pre>
<pre>
  $current_krf = keyrec_curkrf();
  $default_krf = keyrec_defkrf();</pre>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>The <strong>Net::DNS::SEC::Tools::keyrec</strong> module manipulates the contents of
a DNSSEC-Tools <em>keyrec</em> file.  <em>keyrec</em> files contain data about
zones signed by and keys generated by the DNSSEC-Tools programs.  Module
interfaces exist for looking up <em>keyrec</em> records, creating new
records, and modifying existing records.</p>
<p>A <em>keyrec</em> file is organized in sets of <em>keyrec</em> records.  Each <em>keyrec</em>
must be either of <em>key</em> type or <em>zone</em> type.  Key <em>keyrec</em>s describe how
encryption keys were generated, zone <em>keyrec</em>s describe how zones were
signed.  A <em>keyrec</em> consists of a set of keyword/value entries.  The
following is an example of a key <em>keyrec</em>:</p>
<pre>
    key     &quot;Kexample.com.+005+30485&quot;
          zonename        &quot;example.com&quot;
          keyrec_type     &quot;kskcur&quot;
          algorithm       &quot;rsasha1&quot;
          random          &quot;/dev/urandom&quot;
          ksklength       &quot;2048&quot;
          ksklife         &quot;15768000&quot;
          revperiod       &quot;3888000&quot;
          revtime         &quot;1103277532&quot;
          keyrec_gensecs  &quot;1101183727&quot;
          keyrec_gendate  &quot;Tue Nov 23 04:22:07 2004&quot;</pre>
<p>The first step in using this module <strong>must</strong> be to create a new <em>keyrec</em> file
or open and read an existing one.  The <em>keyrec_creat()</em> interface creates a
<em>keyrec</em> file if it does not exist.  The <em>keyrec_read()</em> interface opens
and reads the file, then parses it into an internal format.  The file's
records are copied into a hash table (for easy and fast reference by the
<strong>Net::DNS::SEC::Tools::keyrec</strong> routines) and in an array (for preserving
formatting and comments.) The <em>keyrec_filestat()</em> interface may be used
check that the given file may be a <em>keyrec</em> file, though it doesn't check
the file's contents.</p>
<p>After the file has been read, the contents are referenced using
<em>keyrec_fullrec()</em> and <em>keyrec_recval()</em>.  The <em>keyrec</em> contents are
modified using <em>keyrec_add()</em>, and <em>keyrec_setval()</em>.  <em>keyrec_settime()</em>
will update a <em>keyrec</em>'s timestamp to the current time.  <em>keyrec</em>s may be
deleted with the <em>keyrec_del()</em> interface.</p>
<p>If the <em>keyrec</em> file has been modified, it must be explicitly written or the
changes are not saved.  <em>keyrec_write()</em> saves the new contents to disk.
<em>keyrec_saveas()</em> saves the in-memory <em>keyrec</em> contents to the specified
file name, without affecting the original file.</p>
<p><em>keyrec_close()</em> saves the file and close the Perl file handle to the
<em>keyrec</em> file.  If a <em>keyrec</em> file is no longer wanted to be open, yet the
contents should not be saved, <em>keyrec_discard()</em> gets rid of the data, and
closes the file handle <strong>without</strong> saving any modified data.</p>
<p>
</p>
<hr />
<h1><a name="keyrec_interfaces">KEYREC INTERFACES</a></h1>
<p>The interfaces to the <strong>Net::DNS::SEC::Tools::keyrec</strong> module are given below.</p>
<dl>
<dt><strong><a name="keyrec_add" class="item"><em>keyrec_add(keyrec_type,keyrec_name,fields)</em></a></strong></dt>

<dd>
<p>This routine adds a new <em>keyrec</em> to the <em>keyrec</em> file and the internal
representation of the file contents.  The <em>keyrec</em> is added to both the
<em>%keyrecs</em> hash table and the <em>@keyreclines</em> array.</p>
<p><em>keyrec_type</em> specifies the type of the <em>keyrec</em> -- &quot;key&quot; or &quot;zone&quot;.
<em>keyrec_name</em> is the name of the <em>keyrec</em>.  <em>fields</em> is a reference to a
hash table that contains the name/value <em>keyrec</em> fields.  The keys of the
hash table are always converted to lowercase, but the entry values are left
as given.</p>
<p>The <em>ksklength</em> entry is only added if the value of the <em>keyrec_type</em>
field is &quot;kskcur&quot;.</p>
<p>The <em>zsklength</em> entry is only added if the value of the <em>keyrec_type</em>
field is &quot;zsk&quot;, &quot;zskcur&quot;, &quot;zskpub&quot;, or &quot;zsknew&quot;.</p>
<p>Timestamp fields are added at the end of the <em>keyrec</em>.  For key <em>keyrec</em>s,
the <em>keyrec_gensecs</em> and <em>keyrec_gendate</em> timestamp fields are added.  For
zone <em>keyrec</em>s, the <em>keyrec_signsecs</em> and <em>keyrec_signdate</em> timestamp
fields are added.</p>
<p>If a specified field isn't defined for the <em>keyrec</em> type, the entry isn't
added.  This prevents zone <em>keyrec</em> data from getting mingled with key
<em>keyrec</em> data.</p>
<p>A blank line is added after the final line of the new <em>keyrec</em>.  After adding
all new <em>keyrec</em> entries, the <em>keyrec</em> file is written but is not closed.</p>
<p>Return values are:</p>
<pre>
    0 success
    -1 invalid I&lt;krtype&gt;</pre>
</dd>
<dt><strong><a name="keyrec_close" class="item"><em>keyrec_close()</em></a></strong></dt>

<dd>
<p>This interface saves the internal version of the <em>keyrec</em> file (opened with
<em>keyrec_read()</em>) and closes the file handle.</p>
</dd>
<dt><strong><a name="keyrec_creat" class="item"><em>keyrec_creat(keyrec_file)</em></a></strong></dt>

<dd>
<p>This interface creates a <em>keyrec</em> file if it does not exist, and truncates
the file if it already exists.</p>
<p><em>keyrec_creat()</em> returns 1 if the file was created successfully.
It returns 0 if there was an error in creating the file.</p>
</dd>
<dt><strong><a name="keyrec_curkrf" class="item"><em>keyrec_curkrf()</em></a></strong></dt>

<dd>
<p>This routine returns the name of the <em>keyrec</em> file that is currently in use.
This value is the filename passed to <em>keyrec_read()</em> or <em>keyrec_creat()</em>;
it is not guaranteed to be either an absolute or relative filename.</p>
</dd>
<dt><strong><a name="keyrec_defkrf" class="item"><em>keyrec_defkrf()</em></a></strong></dt>

<dd>
<p>This routine returns the default <em>keyrec</em> filename from the DNSSEC-Tools
configuration file.</p>
</dd>
<dt><strong><a name="keyrec_del" class="item"><em>keyrec_del(keyrec_name)</em></a></strong></dt>

<dd>
<p>This routine deletes a <em>keyrec</em> from the <em>keyrec</em> file and the internal
representation of the file contents.  The <em>keyrec</em> is deleted from both
the <em>%keyrecs</em> hash table and the <em>@keyreclines</em> array.</p>
<p>Only the <em>keyrec</em> itself is deleted from the file.  Any associated comments
and blank lines surrounding it are left intact.</p>
<p>Return values are:</p>
<pre>
     0 successful keyrec deletion
    -1 invalid krtype (empty string or unknown name)</pre>
</dd>
<dt><strong><a name="keyrec_delval" class="item"><em>keyrec_delval(keyrec_name, field)</em></a></strong></dt>

<dd>
<p>This routine deletes the <em>field</em> from the <em>keyrec</em> named by <em>keyrec_name</em>.
The <em>keyrec</em> is deleted from both the <em>%keyrecs</em> hash table and the
<em>@keyreclines</em> array.</p>
<p>Return values are:</p>
<pre>
    -1 keyrec_name not the name of an existing keyrec
     0 field not found in keyrec
     1 field deleted from keyrec</pre>
</dd>
<dt><strong><a name="keyrec_discard" class="item"><em>keyrec_discard()</em></a></strong></dt>

<dd>
<p>This routine removes a <em>keyrec</em> file from use by a program.  The internally
stored data are deleted and the <em>keyrec</em> file handle is closed.  However,
modified data are not saved prior to closing the file handle.  Thus, modified
and new data will be lost.</p>
</dd>
<dt><strong><a name="keyrec_exists" class="item"><em>keyrec_exists(keyrec_name)</em></a></strong></dt>

<dd>
<p><em>keyrec_exists()</em> returns a boolean indicating if a <em>keyrec</em> exists that
has the specified <em>keyrec_name</em>.</p>
</dd>
<dt><strong><a name="keyrec_filestat" class="item"><em>keyrec_filestat(keyrec_name)</em></a></strong></dt>

<dd>
<p><em>keyrec_filestat()</em> checks that a given file might be a reasonable candidate
for a DNSSEC-Tools <em>keyrec</em> file.  The checks to be performed may be gleaned
from the list of return values.</p>
<p>Return values are:
    0 - returned if the tests are all succeed
    1 - an actual name wasn't given
    2 - the file does not exist
    3 - the file is not a regular file
    4 - the file is not readable
    5 - the file is empty</p>
</dd>
<dt><strong><a name="keyrec_fullrec" class="item"><em>keyrec_fullrec(keyrec_name)</em></a></strong></dt>

<dd>
<p><em>keyrec_fullrec()</em> returns a reference to the <em>keyrec</em> specified in
<em>keyrec_name</em>.</p>
</dd>
<dt><strong><a name="keyrec_keyfields" class="item"><em>keyrec_keyfields()</em></a></strong></dt>

<dd>
<p>This routine returns a list of the recognized fields for a key <em>keyrec</em>.</p>
</dd>
<dt><strong><a name="keyrec_keypaths" class="item"><em>keyrec_keypaths(zonename,keytype)</em></a></strong></dt>

<dd>
<p><em>keyrec_keypaths()</em> returns a list of paths to a set of key files for a
given zone.  The zone is specified in <em>zonename</em> and the type of key is
given in <em>keytype</em>.</p>
<p><em>keytype</em> must be one of the following:  &quot;kskcur&quot;, &quot;kskpub&quot;, &quot;kskrev&quot;,
&quot;kskobs&quot;&quot;, &quot;zskcur&quot;, &quot;zskpub&quot;, &quot;zsknew&quot;, &quot;zskobs&quot;, &quot;ksk&quot;, &quot;zsk&quot;, or &quot;all&quot;.
Case does not matter for the <em>keytype</em>.</p>
<p>If <em>keytype</em> is one of the special labels (&quot;ksk&quot;, &quot;zsk&quot;, or &quot;all&quot;) then a
set of key paths will be returned.
A <em>keytype</em> of &quot;ksk&quot; will return paths to all KSK keys for the zone,
a <em>keytype</em> of &quot;zsk&quot; will return paths to all ZSK keys for the zone,
and a <em>keytype</em> of &quot;all&quot; will return paths to all keys for the zone,</p>
<p>If the given key type is not defined in the given zone's zone <em>keyrec</em>
or if the key type is not recognized, then a null set is returned.</p>
</dd>
<dt><strong><a name="keyrec_names" class="item"><em>keyrec_names()</em></a></strong></dt>

<dd>
<p>This routine returns a list of the <em>keyrec</em> names from the file.</p>
</dd>
<dt><strong><a name="keyrec_open" class="item"><em>keyrec_open(keyrec_file)</em> <strong>DEPRECATED</strong></a></strong></dt>

<dd>
<p>This routine used to open an existing DNSSEC-Tools <em>keyrec</em> file.  However,
this was an unnecessary operation since <em>keyrec_read()</em> would open the file
if it wasn't already open.</p>
<p>This call will eventually be removed.  For now, it calls <em>keyrec_filestat()</em>
to check the validity of the specified <em>keyrec</em> file.</p>
<p>Return values:</p>
<pre>
    1 is the file passes all of keyrec_filestat()'s tests
    0 is the file fails any of keyrec_filestat()'s tests</pre>
<p>For backwards compatibility, the success/failure meaning of the return values
matches the success/failure meaning of <em>keyrec_open()</em>'s original returns.</p>
</dd>
<dt><strong><a name="keyrec_read" class="item"><em>keyrec_read(keyrec_file)</em></a></strong></dt>

<dd>
<p>This interface reads the specified <em>keyrec</em> file and parses it into a
<em>keyrec</em> hash table and a file contents array.  <em>keyrec_read()</em> <strong>must</strong> be
called prior to any of the other <strong>Net::DNS::SEC::Tools::keyrec</strong> calls.  If
another <em>keyrec</em> is already open, then it is saved and closed prior to
opening the new <em>keyrec</em>.</p>
<p>Upon success, <em>keyrec_read()</em> returns the number of <em>keyrec</em>s read from the
file.</p>
<p>Failure return values:</p>
<pre>
    -1 specified I&lt;keyrec&gt; file doesn't exist
    -2 unable to open I&lt;keyrec&gt; file
    -3 duplicate I&lt;keyrec&gt; names in file</pre>
</dd>
<dt><strong><a name="keyrec_recval" class="item"><em>keyrec_recval(keyrec_name,keyrec_field)</em></a></strong></dt>

<dd>
<p>This routine returns the value of a specified field in a given <em>keyrec</em>.
<em>keyrec_name</em> is the name of the particular <em>keyrec</em> to consult.
<em>keyrec_field</em> is the field name within that <em>keyrec</em>.</p>
<p>For example, the current <em>keyrec</em> file contains the following <em>keyrec</em>:</p>
<pre>
    zone        &quot;example.com&quot;
                zonefile        &quot;db.example.com&quot;</pre>
<p>The call:</p>
<pre>
    keyrec_recval(&quot;example.com&quot;,&quot;zonefile&quot;)</pre>
<p>will return the value &quot;db.example.com&quot;.</p>
</dd>
<dt><strong><a name="keyrec_revoke_check" class="item"><em>keyrec_revoke_check(key)</em></a></strong></dt>

<dd>
<p>This interface checks a revoked KSK's <em>keyrec</em> to determine if it is in or
out of its revocation period.  The key must be a &quot;kskrev&quot; type key, and it
must have &quot;revtime&quot; and &quot;revperiod&quot; fields defined in the <em>keyrec</em>.</p>
<p>The determination is made by subtracting the revoke time from the current
time.  If this is greater than the revocation period, the the key has
exceeded the time in which it must be revoked.  If not, then it must remain
revoked.</p>
<p>Return values:</p>
<pre>
     1 specified key is outside the revocation period and should be
       marked as obsolete
     0 specified key is in the revocation period and should be left
       revoked
    -1 error (invalid key type, missing I&lt;keyrec&gt; data)</pre>
</dd>
<dt><strong><a name="keyrec_saveas" class="item"><em>keyrec_saveas(keyrec_file_copy)</em></a></strong></dt>

<dd>
<p>This interface saves the internal version of the <em>keyrec</em> file (opened with
or <em>keyrec_read()</em>) to the file named in the <em>keyrec_file_copy</em> parameter.
The new file's file handle is closed, but the original file and the file
handle to the original file are not affected.</p>
</dd>
<dt><strong><a name="keyrec_setval" class="item"><em>keyrec_setval(keyrec_type,keyrec_name,field,value)</em></a></strong></dt>

<dd>
<p>Set the value of a <em>name/field</em> pair in a specified <em>keyrec</em>.  The file is
<strong>not</strong> written after updating the value.  The value is saved in both
<em>%keyrecs</em> and in <em>@keyreclines</em>, and the file-modified flag is set.</p>
<p><em>keyrec_type</em> specifies the type of the <em>keyrec</em>.  This is only used if a
new <em>keyrec</em> is being created by this call.
<em>keyrec_name</em> is the name of the <em>keyrec</em> that will be modified.
<em>field</em> is the <em>keyrec</em> field which will be modified.
<em>value</em> is the new value for the field.</p>
<p>Return values are:</p>
<pre>
    0 if the creation succeeded
    -1 invalid type was given</pre>
</dd>
<dt><strong><a name="keyrec_settime" class="item"><em>keyrec_settime(keyrec_type,keyrec_name)</em></a></strong></dt>

<dd>
<p>Set the timestamp of a specified <em>keyrec</em>.  The file is <strong>not</strong> written
after updating the value.  The value is saved in both <em>%keyrecs</em> and in
<em>@keyreclines</em>, and the file-modified flag is set.  The <em>keyrec</em>'s
<em>keyrec_signdate</em> and <em>keyrec_signsecs</em> fields are modified.</p>
</dd>
<dt><strong><a name="keyrec_write" class="item"><em>keyrec_write()</em></a></strong></dt>

<dd>
<p>This interface saves the internal version of the <em>keyrec</em> file (opened with
or <em>keyrec_read()</em>).  It does not close the file handle.  As an efficiency
measure, an internal modification flag is checked prior to writing the file.
If the program has not modified the contents of the <em>keyrec</em> file, it is not
rewritten.</p>
<p><em>keyrec_write()</em> gets an exclusive lock on the <em>keyrec</em> file while writing.</p>
</dd>
<dt><strong><a name="keyrec_zonefields" class="item"><em>keyrec_zonefields()</em></a></strong></dt>

<dd>
<p>This routine returns a list of the recognized fields for a zone <em>keyrec</em>.</p>
</dd>
</dl>
<p>
</p>
<hr />
<h1><a name="keyrec_signing_set_interfaces">KEYREC SIGNING-SET INTERFACES</a></h1>
<p>Signing sets are collections of encryption keys, defined by inclusion in a
particular &quot;set&quot; <em>keyrec</em>.  The names of the keys are in the <em>keyrec</em>'s
<em>keys</em> record, which contains the names of the key <em>keyrec</em>s.  Due to the
way key names are handled, the names in a signing set must not contain spaces.</p>
<p>The signing-set-specific interfaces are given below.</p>
<dl>
<dt><strong><a name="keyrec_signset_newname" class="item"><em>keyrec_signset_newname(zone_name)</em></a></strong></dt>

<dd>
<p><em>keyrec_signset_newname()</em> creates a name for a new signing set.  The name
will be generated by referencing the <em>lastset</em> field in the <em>keyrec</em> for
zone <em>zone_name</em>, if the <em>keyrec</em> has such a field.  The set index number
(described below) will be incremented and the <em>lastset</em> with the new index
number will be returned as the new signing set name.  If the zone <em>keyrec</em>
does not have a <em>lastset</em> field, then the default set name of
<em>signing-set-0</em> will be used.</p>
<p>The set index number is the first number found in the <em>lastset</em> field.  It
doesn't matter where in the field it is found, the first number will be
considered to be the signing set index.  The examples below show how this is
determined:</p>
<pre>
    lastset field               index
    -------------               -----
    signing-set-0                  0
    signing-0-set                  0
    1-signing-0-set                1
    signing-88-set-1              88
    signingset4321              4321</pre>
</dd>
<dt><strong><a name="keyrec_signset_new" class="item"><em>keyrec_signset_new(zone,signing_set_name,set_type)</em></a></strong></dt>

<dd>
<p><em>keyrec_signset_new()</em> creates the signing set named by <em>signing_set_name</em>
for the zone <em>zone</em>.  It is given the type <em>type</em>, which must be one of the
following:  &quot;kskcur&quot;, &quot;kskpub&quot;, &quot;kskrev&quot;, &quot;kskobs&quot;, &quot;zskcur&quot;, &quot;zskpub&quot;,
&quot;zsknew&quot;, or &quot;zskobs&quot;.</p>
<p>It returns 1 if the call is successful; 0 if it is not.</p>
</dd>
<dt><strong><a name="keyrec_signset_addkey" class="item"><em>keyrec_signset_addkey(signing_set_name,key_list)</em></a></strong></dt>

<dd>
<p><em>keyrec_signset_addkey()</em> adds the keys listed in <em>key_list</em> to the signing
set named by <em>signing_set_name</em>.  <em>key_list</em> may either be an array or a set
or arguments to the routine.  The <em>keyrec</em> is created if it does not already
exist.
It returns 1 if the call is successful; 0 if it is not.</p>
</dd>
<dt><strong><a name="keyrec_signset_delkey" class="item"><em>keyrec_signset_delkey(signing_set_name,key_name)</em></a></strong></dt>

<dd>
<p><em>keyrec_signset_delkey()</em> deletes the key given in <em>key_name</em> to the
signing set named by <em>signing_set_name</em>.
It returns 1 if the call is successful; 0 if it is not.</p>
</dd>
<dt><strong><a name="keyrec_signset_haskey" class="item"><em>keyrec_signset_haskey(signing_set_name,key_name)</em></a></strong></dt>

<dd>
<p><em>keyrec_signset_haskey()</em> returns a flag indicating if the key specified
in <em>key_name</em> is one of the keys in the signing set named by
<em>signing_set_name</em>.
It returns 1 if the signing set has the key; 0 if it does not.</p>
</dd>
<dt><strong><a name="keyrec_signset_clear" class="item"><em>keyrec_signset_clear(keyrec_name)</em></a></strong></dt>

<dd>
<p><em>keyrec_signset_clear()</em> clears the entire signing set from the <em>keyrec</em>
named by <em>keyrec_name</em>.
It returns 1 if the call is successful; 0 if it is not.</p>
</dd>
<dt><strong><a name="keyrec_signsets" class="item"><em>keyrec_signsets()</em></a></strong></dt>

<dd>
<p><em>keyrec_signsets()</em> returns the names of the signing sets in the <em>keyrec</em>
file.  These names are returned in an array.</p>
</dd>
<dt><strong><a name="keyrec_signset_keys" class="item"><em>keyrec_signset_keys(keyrec_name,signset_type)</em></a></strong></dt>

<dd>
<p><em>keyrec_signset_keys()</em> returns the names of the keys that are members of
a given signing set in the <em>keyrec</em> file.  The keys are returned in a
space-separated string.</p>
<p>There are two ways of calling <em>keyrec_signset_keys()</em>.   The first method
specifies a zone <em>keyrec</em> name and a signing set type.  The signing set name
is found by referencing the set field in the zone <em>keyrec</em>, then the <em>keys</em>
field of that signing set is returned.</p>
<p>The second method specifies the signing set directly, and its <em>keys</em> field
is returned.</p>
<p>Valid signing set types are:</p>
<pre>
    kskcur        kskpub        kskrev        kskobs
    zskcur        zskpub        zsknew        zskobs</pre>
<p>The following errors are recognized, resulting in an undefined return:</p>
<pre>
    keyrec_name is not a defined keyrec
    signset_type is an invalid signing set type
    the signing set keyrec is not a set keyrec</pre>
</dd>
</dl>
<p>
</p>
<hr />
<h1><a name="keyrec_internal_interfaces">KEYREC INTERNAL INTERFACES</a></h1>
<p>The interfaces described in this section are intended for internal use by the
<strong>keyrec.pm</strong> module.  However, there are situations where external entities
may have need of them.  Use with caution, as misuse may result in damaged or
lost <em>keyrec</em> files.</p>
<dl>
<dt><strong><a name="keyrec_init" class="item"><em>keyrec_init()</em></a></strong></dt>

<dd>
<p>This routine initializes the internal <em>keyrec</em> data.  Pending changes will
be lost.  An open <em>keyrec</em> file handle will remain open, though the data are
no longer held internally.  A new <em>keyrec</em> file must be read in order to use
the <strong>keyrec.pm</strong> interfaces again.</p>
</dd>
<dt><strong><a name="keyrec_newkeyrec" class="item"><em>keyrec_newkeyrec(kr_name,kr_type)</em></a></strong></dt>

<dd>
<p>This interface creates a new <em>keyrec</em>.  The <em>keyrec_name</em> and <em>keyrec_hash</em>
fields in the <em>keyrec</em> are set to the values of the <em>kr_name</em> and <em>kr_type</em>
parameters.  <em>kr_type</em> must be either &quot;key&quot; or &quot;zone&quot;.</p>
<p>Return values are:</p>
<pre>
    0 if the creation succeeded
    -1 if an invalid I&lt;keyrec&gt; type was given</pre>
</dd>
</dl>
<p>
</p>
<hr />
<h1><a name="keyrec_debugging_interfaces">KEYREC DEBUGGING INTERFACES</a></h1>
<p>The following interfaces display information about the currently parsed
<em>keyrec</em> file.  They are intended to be used for debugging and testing, but
may be useful at other times.</p>
<dl>
<dt><strong><a name="keyrec_dump_hash" class="item"><em>keyrec_dump_hash()</em></a></strong></dt>

<dd>
<p>This routine prints the <em>keyrec</em> file as it is stored internally in a hash
table.  The <em>keyrec</em>s are printed in alphabetical order, with the fields
alphabetized for each <em>keyrec</em>.  New <em>keyrec</em>s and <em>keyrec</em> fields are
alphabetized along with current <em>keyrec</em>s and fields.  Comments from the
<em>keyrec</em> file are not included with the hash table.</p>
</dd>
<dt><strong><a name="keyrec_dump_array" class="item"><em>keyrec_dump_array()</em></a></strong></dt>

<dd>
<p>This routine prints the <em>keyrec</em> file as it is stored internally in
an array.  The <em>keyrec</em>s are printed in the order given in the file,
with the fields ordered in the same manner.  New <em>keyrec</em>s are
appended to the end of the array.  <em>keyrec</em> fields added to existing
<em>keyrec</em>s are added at the beginning of the <em>keyrec</em> entry.
Comments and vertical whitespace are preserved as given in the
<em>keyrec</em> file.</p>
</dd>
</dl>
<p>
</p>
<hr />
<h1><a name="copyright">COPYRIGHT</a></h1>
<p>Copyright 2005-2012 SPARTA, Inc.  All rights reserved.
See the COPYING file included with the DNSSEC-Tools package for details.</p>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Wayne Morrison, <a href="mailto:tewok@users.sourceforge.net">tewok@users.sourceforge.net</a></p>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p><strong>Net::DNS::SEC::Tools::conf(5)</strong>,
<strong>Net::DNS::SEC::Tools::keyrec(5)</strong></p>

</body>

</html>
