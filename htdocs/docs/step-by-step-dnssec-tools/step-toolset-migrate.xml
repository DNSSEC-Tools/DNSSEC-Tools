<?xml version="1.0" encoding="UTF-8"?>
<chapter>
  <title>Migrate to the Toolset</title>

  <para>The zonesigner tool simplifies the maintenance of a signed zone. It
  automates many of the routine tasks required for signing a zone. Given this,
  an operator already using BIND tools to maintain a signed zone may want to
  transition over to zonesigner, while still retaining existing keys that are
  being used to sign a zone.</para>

  <para>This section provides step-by-step instructions to transition from
  using BIND tools for maintaining a signed zone to using zonesigner. In the
  examples given below, the zone example.com is currently signed, signed zone
  file is maintained using <command>dnssec-signzone</command> command from
  BIND 9.3.1, and the following files are present:</para>

  <table colsep="0" frame="none" rowsep="0">
    <title>Example Files</title>

    <tgroup cols="2">
      <thead>
        <row>
          <entry>File</entry>

          <entry>Description</entry>
        </row>
      </thead>

      <tbody>
        <row>
          <entry>db-in.example.com.</entry>

          <entry>Unsigned zone file</entry>
        </row>

        <row>
          <entry>db-in.example.com..signed</entry>

          <entry>Signed zone file</entry>
        </row>

        <row>
          <entry>Kexample.com.+005+47670</entry>

          <entry>KSK files prefix</entry>
        </row>

        <row>
          <entry>Kexample.com.+005+48926</entry>

          <entry>ZSK files prefix</entry>
        </row>
      </tbody>
    </tgroup>
  </table>

  <section>
    <title>Generate the keyrec file</title>

    <para><prompt>$</prompt> <command>genkrf
    <option>-zone=<option>example.com</option></option>
    <option>-ksk=<option>Kexample.com.+005+47670</option></option>
    <option>-zskcur=<option>Kexample.com.+005+48926</option></option><filename>db-in.example.com.</filename>
    <filename>db-in.example.com..signed</filename></command></para>

    <para>The <command>genkrf</command> command generates a keyrec file from
    existing key files. It also generates any additional keys that zonesigner
    uses. In the above example, <command>genkrf</command> will generate a new
    key <option>zskpub</option> along with the keyrec file named
    <filename>example.com.krf</filename>. It will display the following
    message if successful:</para>

    <para><computeroutput>genkrf: file example.com.krf created
    successfully.</computeroutput></para>
  </section>

  <section>
    <title>Verify the keyrec file</title>

    <para>Examine the contents of the keyrec file and ensure that the original
    KSK and ZSK files are being used.</para>

    <para><prompt>$</prompt> <command>grep
    <option>Kexample.com.+005+47670</option>
    <filename>example.com.krf</filename></command> <userinput>[ENTER]</userinput></para>

    <para><computeroutput>kskdir
    "Kexample.com.+005+47670"</computeroutput></para>

    <para><prompt>$</prompt> <command>grep
    <option>Kexample.com.+005+48296</option>
    <filename>example.com.krf</filename></command> <userinput>[ENTER]</userinput></para>

    <para><computeroutput>zskcur
    "Kexample.com.+005+48296"</computeroutput></para>
  </section>

  <section>
    <title>Resign the zone with zonesigner</title>

    <para>See <xref linkend="step-zone-resign" /> for how to resign the
    zone.</para>
  </section>
</chapter>