<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Emergency KSK Rollover (KSK Compromise)</title><meta name="generator" content="DocBook XSL Stylesheets V1.70.1"><link rel="start" href="index.html" title="Step-by-Step DNSSEC-Tools Operator Guidance Document"><link rel="up" href="index.html" title="Step-by-Step DNSSEC-Tools Operator Guidance Document"><link rel="prev" href="step-emergency-zsk.html" title="Emergency ZSK Rollover (Published and Current ZSK
    Compromise)"><link rel="next" href="step-emergency-ksk-parent.html" title="Parent Action During Child KSK Compromise"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Emergency KSK Rollover (KSK Compromise)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="step-emergency-zsk.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="step-emergency-ksk-parent.html">Next</a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="step-emergency-ksk"></a>Emergency KSK Rollover (KSK Compromise)</h2></div></div></div><p>The emergency procedures described for key roll-over use the
    rationale that injection of valid but false data (which can be generated
    using the compromised key) is more serious than discontinuity in our
    ability to validate true data. Thus, during emergency KSK roll-over, there
    will be a period (up to twice the maximum zone TTL) where it may not be
    possible to build an "authentication chain" from the zone data to the new
    KSK.</p><p>The DNSSEC-Tools utilities do not currently handle emergency KSK
    rollover. However, the utilities may be used to automate
    <span class="emphasis"><em>some</em></span> of the steps required.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id936344"></a>Emergency Current KSK Rollover Using DNSSEC-Tools</h3></div></div></div><p>The steps given below detail the steps that must be taken during
        emergency KSK rollover when using DNSSEC-Tools to assist in
        rollover.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-auto-1"></a>Inform Parent about the KSK Compromise</h4></div></div></div><p>This communication between parent and child must be done
            securely using out-of-band mechanisms.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-auto-2"></a>Wait for the Parent to Remove the Zone's DS Record</h4></div></div></div><p>Before proceeding, wait for the parent zone to remove the DS
            record. This may be determined by using the <span><strong class="command">dig</strong></span>
            command to retrieve the parent's DS record.</p><p><span><strong class="command"># dig @<span class="bold"><strong>parent-IP-address</strong></span> DS <span class="bold"><strong>zone.name</strong></span></strong></span>
            <strong class="userinput"><code>[ENTER]</code></strong></p><p><code class="computeroutput">...</code></p><p><code class="computeroutput"> :: flags: qr aa rd: QUERY: 1, ANSWER: 0,
            AUTHORITY: 1, ADDITIONAL : 0 </code></p><p><code class="computeroutput">...</code></p><p><span><strong class="command">#</strong></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id936448"></a>Stop Automatic Zone Rollover</h4></div></div></div><p>The <span class="bold"><strong>rollerd</strong></span> command must
            not be executing during this procedure.</p><table class="simplelist" border="0" summary="Simple list"><tr><td><span><strong class="command"># rollctl -halt</strong></span>
                <strong class="userinput"><code>[ENTER]</code></strong></td></tr><tr><td><span><strong class="command">#</strong></span></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id936489"></a>Generate New Keys </h4></div></div></div><p>Since the KSK has been compromised it must be regenerated.
            In addition, the ZSKs can no longer be trusted so they too must be
            regenerated. This may be done with a single <span class="bold"><strong>zonesigner</strong></span> execution.</p><table class="simplelist" border="0" summary="Simple list"><tr><td><span><strong class="command"># zonesigner -genkeys zone.name</strong></span>
                <strong class="userinput"><code>[ENTER]</code></strong></td></tr><tr><td><span><strong class="command">#</strong></span></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id936533"></a>Fix the Keyrec File</h4></div></div></div><p>The <span class="bold"><strong>zonesigner</strong></span> command in
            the previous step will have left the compromised zone's keyrec
            file in an inconsistent state. Consequently, the keyrec file must
            be edited to return it to a valid state.</p><p>The steps below should be followed to fix the keyrec file
            for the KSK keys.</p><div class="orderedlist"><ol type="1"><li><p>Find the name of the zone's keyrec file.  This may
		    be done with the following command:</p><table class="simplelist" border="0" summary="Simple list"><tr><td>
			<span><strong class="command"># lsroll -keyrec -terse rollrec-file</strong></span>
       	       		  <strong class="userinput"><code>[ENTER]</code></strong></td></tr><tr><td><span><strong class="command">#</strong></span></td></tr></table></li><li><p>Find the name of the zone's Current KSK.
		    Look for the <span class="emphasis"><em>zone</em></span> keyrec entry for
		    the compromised zone, and find its
                    <span class="emphasis"><em>ksk</em></span> entry.  This holds the name
		    of the KSK.
		    </p></li><li><p>Edit the keyrec file and search for all
                    <span class="emphasis"><em>key</em></span> keyrec entries with a
                    <span class="emphasis"><em>keyrec_type</em></span> of "<span class="bold"><strong>ksk</strong></span>". Any keys with this type
                    that are not the Current KSK should be given
                    the type "<span class="bold"><strong>kskobs</strong></span>".</p></li></ol></div><p>The steps below should be followed to fix the keyrec file
            for the Current ZSK keys.</p><div class="orderedlist"><ol type="1"><li><p>Find the name of the zone's keyrec file.  This may
		    be done with the following command:</p><table class="simplelist" border="0" summary="Simple list"><tr><td>
			<span><strong class="command"># lsroll -keyrec -terse rollrec-file</strong></span>
       	       		  <strong class="userinput"><code>[ENTER]</code></strong></td></tr><tr><td><span><strong class="command">#</strong></span></td></tr></table></li><li><p>Find the name of the zone's Current ZSK signing set.
		    Look for the <span class="emphasis"><em>zone</em></span> keyrec entry for
		    the compromised zone, and find its
                    <span class="emphasis"><em>zskcur</em></span> entry.  This holds the name
		    of the Current ZSK signing set.
		    </p></li><li><p>Get the names of the keys in the Current ZSK signing
                    set.  Look for the <span class="emphasis"><em>set</em></span> keyrec entry for
		    the Current ZSK signing set.  The keys listed in that
		    set's <span class="emphasis"><em>keys</em></span> entry are the ZSK keys in
		    the Current ZSK signing set.
		    </p></li><li><p>Edit the keyrec file and search for all
                    <span class="emphasis"><em>key</em></span> keyrec entries with a
                    <span class="emphasis"><em>keyrec_type</em></span> of "<span class="bold"><strong>zskcur</strong></span>". Any keys with this type
                    that are not in the Current signing set should be given
                    the type "<span class="bold"><strong>zskobs</strong></span>".</p></li></ol></div><p>The steps below should be followed to fix the keyrec file
            for the Published KSK keys.</p><div class="orderedlist"><ol type="1"><li><p>Find the name of the zone's keyrec file.  This may
		    be done with the following command:</p><table class="simplelist" border="0" summary="Simple list"><tr><td>
			<span><strong class="command"># lsroll -keyrec -terse rollrec-file</strong></span>
       	       		  <strong class="userinput"><code>[ENTER]</code></strong></td></tr><tr><td><span><strong class="command">#</strong></span></td></tr></table></li><li><p>Find the name of the zone's Published signing set.
		    Look for the <span class="emphasis"><em>zone</em></span> keyrec entry for
		    the compromised zone, and find its
                    <span class="emphasis"><em>zskpub</em></span> entry.  This holds the name
		    of the Published ZSK signing set.
		    </p></li><li><p>Get the names of the keys in the Published signing
                    set.  Look for the <span class="emphasis"><em>set</em></span> keyrec entry for
		    the Published ZSK signing set.  The keys listed in that
		    set's <span class="emphasis"><em>keys</em></span> entry are the ZSK keys in
		    the Published ZSK signing set.
		    </p></li><li><p>Edit the keyrec file and search for all
                    <span class="emphasis"><em>key</em></span> keyrec entries with a
                    <span class="emphasis"><em>keyrec_type</em></span> of "<span class="bold"><strong>zskpub</strong></span>". Any keys with this type
                    that are not in the Published signing set should be given
                    the type "<span class="bold"><strong>zskobs</strong></span>".</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-auto-3"></a>Perform Steps in Section ??? if this Zone is a Secure
            Delegation from Another Zone</h4></div></div></div><p>Send the keyset generated from the zone-signing process in
            Section ??? to the parent in order to complete the secure
            delegation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-auto-4"></a>Reload the Zone</h4></div></div></div><p>The <span><strong class="command">rndc</strong></span> will reload the name server
            configuration files and the zone contents. The name server process
            is assumed to be already running.</p><table class="simplelist" border="0" summary="Simple list"><tr><td><span><strong class="command"># rndc reload zone-name</strong></span>
                <strong class="userinput"><code>[ENTER]</code></strong></td></tr><tr><td><span><strong class="command">#</strong></span></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-auto-5"></a>Dispose of the Old Zone Key</h4></div></div></div><p>Delete the old ZSK's <span class="emphasis"><em>.private</em></span> and
            <span class="emphasis"><em>.key</em></span> files.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id936954"></a>Restart Automatic Zone Rollover</h4></div></div></div><p>Automatic rollover may be restarted by executing the
            <span class="bold"><strong>rollerd</strong></span> command. It should be
            given the same options as when it was originally started. </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="step-rollover-ksk-emergency"></a>Manual Emergency Current KSK Rollover</h3></div></div></div><p>The steps given below detail the manual steps that must be taken
        during emergency KSK rollover.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-1"></a>Inform Parent about the KSK Compromise</h4></div></div></div><p>This communication between parent and child must be done
            securely using out-of-band mechanisms.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-2"></a>Wait for the Parent to Remove the Zone's DS Record</h4></div></div></div><p>Before proceeding, wait for the parent zone to remove the DS
            record. This may be determined by using the <span><strong class="command">dig</strong></span>
            command to retrieve the parent's DS record.</p><p><span><strong class="command"># dig @<span class="bold"><strong>parent-IP-address</strong></span> DS <span class="bold"><strong>zone.name</strong></span></strong></span>
            <strong class="userinput"><code>[ENTER]</code></strong></p><p><code class="computeroutput">...</code></p><p><code class="computeroutput"> :: flags: qr aa rd: QUERY: 1, ANSWER: 0,
            AUTHORITY: 1, ADDITIONAL : 0 </code></p><p><code class="computeroutput">...</code></p><p><span><strong class="command">#</strong></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-3"></a>Generate a New KSK</h4></div></div></div><p>Follow the steps in Section ??? for generation of a new KSK.
            Update the Key-Tag Table with the new KSK. Delete the Current KSK.
            Karm the status of the New KSK as Current (C).</p><div class="table"><a name="id937094"></a><p class="title"><b>Table 18. </b></p><div class="table-contents"><table border="1"><colgroup><col><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col></colgroup><tbody><tr><td rowspan="2" align="center">
                                <span class="bold"><strong>Zone</strong></span>
                            </td><td colspan="4" align="center">
                                <span class="bold"><strong>ZSKs</strong></span>
                            </td><td colspan="4" align="center">
                                <span class="bold"><strong>KSKs</strong></span>
                            </td><td rowspan="2" align="center">
                                <span class="bold"><strong>Exp</strong></span>
                            </td></tr><tr><td align="center">Tag</td><td align="center">Size</td><td align="center">Creat</td><td align="center">S</td><td align="center">Tag</td><td align="center">Size</td><td align="center">Creat</td><td align="center">S</td></tr><tr><td rowspan="2" align="center">
                                <span class="emphasis"><em>zone-name</em></span>

                                <span class="emphasis"><em></em></span>

                                <span class="emphasis"><em></em></span>
                            </td><td align="center">
                                <span class="underline">zsktag-cur</span>
                            </td><td align="center">1024</td><td align="center">
                                <span class="underline">date</span>
                            </td><td align="center">C</td><td align="center">
                                <span class="underline">ksktag-cur</span>

                                <span class="underline"></span>

                                <span class="underline"></span>
                            </td><td align="center">2048</td><td align="center">
                                <span class="underline">date</span>

                                <span class="underline"></span>

                                <span class="underline"></span>
                            </td><td align="center">C</td><td align="center">
                                <span class="underline">date</span>

                                <span class="underline"></span>

                                <span class="underline"></span>
                            </td></tr><tr><td align="center">
                                <span class="underline">zsktag-pub</span>
                            </td><td align="center">1024</td><td align="center">
                                <span class="underline">date</span>
                            </td><td align="center">P</td><td align="center">
                                <span class="underline">ksktag-new</span>
                            </td><td align="center">2048</td><td align="center">
                                <span class="underline">date</span>
                            </td><td align="center">C</td><td align="center">date</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-4"></a>Modify the Zone File</h4></div></div></div><p>The zone file must be modified to account for the key
            changes. The Current KSK must be deleted and the New KSK must be
            added. Also, the SOA serial number must be incremented so that the
            zone file's new contents will be recognized.</p><p>The required key changes are made by modifying the <span class="bold"><strong>$INCLUDE</strong></span> lines at the end of the file. The
            <span class="bold"><strong>$INCLUDE</strong></span> line for the Current KSK
            must be deleted. An <span class="bold"><strong>$INCLUDE</strong></span> line
            for the New KSK must be added.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-5"></a>Regenerate the ZSKs</h4></div></div></div><p>The ZSKs can no longer be trusted. Follow the steps in
            Sections ??? and ??? to create the new Current ZSK and Published
            ZSK.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-6"></a>Sign the Zone with the Current KSK and Current ZSK</h4></div></div></div><p>Follow the steps in Sections ??? - ??? if the zone does no
            delegation. Follow the steps in Sections ??? - ??? if the zone
            does delegation. The ZSK used in the signing process in Section
            ??? or ??? must be the key that is marked as the Current key (C)
            in the Key-Tag table. The KSK is the new key which has been marked
            with the status Current (C).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-7"></a>Perform Steps in Section ??? if this Zone is a Secure
            Delegation from Another Zone</h4></div></div></div><p>Send the keyset generated from the zone-signing process in
            Section ??? to the parent in order to complete the secure
            delegation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-8"></a>Reload the Zone</h4></div></div></div><p>The <span><strong class="command">rndc</strong></span> will reload the name server
            configuration files and the zone contents. The name server process
            is assumed to be already running.</p><table class="simplelist" border="0" summary="Simple list"><tr><td><span><strong class="command"># rndc reload zone-name</strong></span>
                <strong class="userinput"><code>[ENTER]</code></strong></td></tr><tr><td><span><strong class="command">#</strong></span></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="step-rollover-ksk-emergency-9"></a>Dispose of the Old Zone Key</h4></div></div></div><p>Delete the old ZSK's <span class="emphasis"><em>.private</em></span> and
            <span class="emphasis"><em>.key</em></span> files.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="step-emergency-zsk.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="step-emergency-ksk-parent.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Emergency ZSK Rollover (Published and Current ZSK
    Compromise) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Parent Action During Child KSK Compromise</td></tr></table></div></body></html>
