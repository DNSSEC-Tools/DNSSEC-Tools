<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Net::DNS::SEC::Tools::keyrec - Squoodge around with a B&lt;dnssec-tools&gt; keyrec file.</title>
<link rev="made" href="mailto:root@localhost" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<li><a href="#keyrec_interfaces">KEYREC INTERFACES</a></li>
	<ul>

		<li><a href="#keyrec_add_keyrec_type_keyrec_name_fields_"><em>keyrec_add(keyrec_type,keyrec_name,fields)</em></a></li>
		<li><a href="#keyrec_del_keyrec_name_"><em>keyrec_del(keyrec_name)</em></a></li>
		<li><a href="#keyrec_close__"><em>keyrec_close()</em></a></li>
		<li><a href="#keyrec_discard__"><em>keyrec_discard()</em></a></li>
		<li><a href="#keyrec_fullrec_keyrec_name_"><em>keyrec_fullrec(keyrec_name)</em></a></li>
		<li><a href="#keyrec_keyfields__"><em>keyrec_keyfields()</em></a></li>
		<li><a href="#keyrec_names__"><em>keyrec_names()</em></a></li>
		<li><a href="#keyrec_read_keyrec_file_"><em>keyrec_read(keyrec_file)</em></a></li>
		<li><a href="#keyrec_recval_keyrec_name_keyrec_field_"><em>keyrec_recval(keyrec_name,keyrec_field)</em></a></li>
		<li><a href="#keyrec_setval_keyrec_type_keyrec_name_field_value_"><em>keyrec_setval(keyrec_type,keyrec_name,field,value)</em></a></li>
		<li><a href="#keyrec_write__"><em>keyrec_write()</em></a></li>
		<li><a href="#keyrec_zonefields__"><em>keyrec_zonefields()</em></a></li>
	</ul>

	<li><a href="#keyrec_internal_interfaces">KEYREC INTERNAL INTERFACES</a></li>
	<ul>

		<li><a href="#keyrec_init__"><em>keyrec_init()</em></a></li>
		<li><a href="#keyrec_newkeyrec_kr_name_kr_type_"><em>keyrec_newkeyrec(kr_name,kr_type)</em></a></li>
	</ul>

	<li><a href="#keyrec_debugging_interfaces">KEYREC DEBUGGING INTERFACES</a></li>
	<ul>

		<li><a href="#keyrec_dump_hash__"><em>keyrec_dump_hash()</em></a></li>
		<li><a href="#keyrec_dump_array__"><em>keyrec_dump_array()</em></a></li>
	</ul>

	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<hr />
<h1><a name="name">NAME</a></h1>
<p>Net::DNS::SEC::Tools::keyrec - Squoodge around with a <strong>dnssec-tools</strong> keyrec file.</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<pre>
  use Net::DNS::SEC::Tools::keyrec;</pre>
<pre>
  keyrec_read(&quot;localzone.keyrec&quot;);</pre>
<pre>
  @krnames = keyrec_names();</pre>
<pre>
  $krec = keyrec_fullrec(&quot;portrigh.com&quot;);
  %keyhash = %$krec;
  $zname = $keyhash{&quot;algorithm&quot;};</pre>
<pre>
  $val = keyrec_recval(&quot;portrigh.com&quot;,&quot;zonefile&quot;);</pre>
<pre>
  keyrec_add(&quot;zone&quot;,&quot;portrigh.com&quot;,\%zone_krfields);
  keyrec_add(&quot;key&quot;,&quot;Kportrigh.com.+005+12345&quot;,\%keydata);</pre>
<pre>
  keyrec_del(&quot;portrigh.com&quot;);
  keyrec_del(&quot;Kportrigh.com.+005+12345&quot;);</pre>
<pre>
  keyrec_setval(&quot;zone&quot;,&quot;portrigh.com&quot;,&quot;zonefile&quot;,&quot;db.portrigh.com&quot;);</pre>
<pre>
  @keyfields = keyrec_keyfields();
  @zonefields = keyrec_zonefields();</pre>
<pre>
  keyrec_write();
  keyrec_close();
  keyrec_discard();</pre>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>The <em>Net::DNS::SEC::Tools::keyrec</em> module manipulates the contents of
a <strong>dnssec-tools</strong> <em>keyrec</em> file.  <em>keyrec</em> files contain data about
zones signed by and keys generated by the <strong>dnssec-tools</strong>.  Module
interfaces exist for looking up <em>keyrec</em> records, creating new
records, and modifying existing records.</p>
<p>A <em>keyrec</em> file is organized in sets of <em>keyrec</em> records.  Each <em>keyrec</em>
must be either of key type or zone type.  Key <em>keyrec</em>s describe how
encryption keys were generated, zone <em>keyrec</em>s describe how zones were
signed.  A <em>keyrec</em> consists of a set of keyword/value entries.  The
following is an example of a key <em>keyrec</em>:</p>
<pre>
    key     &quot;Kportrigh.com.+005+30485&quot;
          zonename        &quot;portrigh.com&quot;
          keyrec_type     &quot;ksk&quot;
          algorithm       &quot;rsasha1&quot;
          random          &quot;/dev/urandom&quot;
          zsklength       &quot;512&quot;
          keyrec_gensecs  &quot;1101183727&quot;
          keyrec_gendate  &quot;Tue Nov 23 04:22:07 2004&quot;</pre>
<p>The first step in using this module <strong>must</strong> be to read the <em>keyrec</em>
file.  The <em>keyrec_read()</em> interface reads the file and parses it
into an internal format.  The file's records are copied into a hash
table (for easy reference by the <em>Net::DNS::SEC::Tools::keyrec</em>
routines) and in an array (for preserving formatting and comments.)</p>
<p>After the file has been read, the contents are referenced using
<em>keyrec_fullrec()</em> and <em>keyrec_recval()</em>.  The contents are modified
using <em>keyrec_add()</em> and <em>keyrec_setval()</em>.</p>
<p>If the <em>keyrec</em> file has been modified, it must be explicitly written or the
changes are not saved.  <em>keyrec_write()</em> saves the new contents to disk.
<em>keyrec_close()</em> saves the file and close the Perl file handle to the
<em>keyrec</em> file.  If a <em>keyrec</em> file is no longer wanted to be open, yet the
contents should not be saved, <em>keyrec_discard()</em> gets rid of the data closes
and the file handle <strong>without</strong> saving any modified data.</p>
<p>
</p>
<hr />
<h1><a name="keyrec_interfaces">KEYREC INTERFACES</a></h1>
<p>The interfaces to the <em>Net::DNS::SEC::Tools::keyrec</em> module are given below.</p>
<p>
</p>
<h2><a name="keyrec_add_keyrec_type_keyrec_name_fields_"><em>keyrec_add(keyrec_type,keyrec_name,fields)</em></a></h2>
<p>This routine adds a new <em>keyrec</em> to the <em>keyrec</em> file and the internal
representation of the file contents.  The <em>keyrec</em> is added to both the
<em>%keyrecs</em> hash table and the <em>@keyreclines</em> array.</p>
<p><em>keyrec_type</em> specifies the type of the <em>keyrec</em> -- ``key'' or ``zone''.
<em>keyrec_name</em> is the name of the <em>keyrec</em>.  <em>fields</em> is a reference to a
hash table that contains the name/value <em>keyrec</em> fields.  The keys of the
hash table are always converted to lowercase, but the entry values are left
as given.</p>
<p>The <em>ksklength</em> entry is only added if <em>keyrec_type</em> is ``ksk''.</p>
<p>The <em>zsklength</em> entry is only added if <em>keyrec_type</em> is ``zsk''.</p>
<p>Timestamp fields are added at the end of the <em>keyrec</em>.  For key <em>keyrec</em>s, the
<em>keyrec_gensecs</em> and <em>keyrec_gendate</em> timestamp fields are added.  For zone
<em>keyrec</em>s, the <em>keyrec_signsecs</em> and <em>keyrec_signdate</em> timestamp fields
are added.</p>
<p>If a specified field isn't defined for the <em>keyrec</em> type, the entry isn't
added.  This prevents zone <em>keyrec</em> data from getting mingled with key
<em>keyrec</em> data.</p>
<p>A blank line is added after the final line of the new <em>keyrec</em>.  After adding
all new <em>keyrec</em> entries, the <em>keyrec</em> file is written but is not closed.</p>
<p>Return values are:</p>
<pre>
    0 success</pre>
<pre>
    -1 invalid I&lt;krtype&gt;</pre>
<p>
</p>
<h2><a name="keyrec_del_keyrec_name_"><em>keyrec_del(keyrec_name)</em></a></h2>
<p>This routine deletes a <em>keyrec</em> from the <em>keyrec</em> file and the internal
representation of the file contents.  The <em>keyrec</em> is deleted from both
the <em>%keyrecs</em> hash table and the <em>@keyreclines</em> array.</p>
<p>Only the <em>keyrec</em> itself is deleted from the file.  Any associated comments
and blank lines surrounding it are left intact.</p>
<p>Return values are:</p>
<pre>
    0 successful I&lt;keyrec&gt; deletion</pre>
<pre>
    -1 invalid I&lt;krtype&gt; (empty string or unknown name)</pre>
<p>
</p>
<h2><a name="keyrec_close__"><em>keyrec_close()</em></a></h2>
<p>This interface saves the internal version of the <em>keyrec</em> file (opened with
<em>keyrec_read()</em>) and closes the file handle.</p>
<p>
</p>
<h2><a name="keyrec_discard__"><em>keyrec_discard()</em></a></h2>
<p>This routine removes a <em>keyrec</em> file from use by a program.  The internally
stored data are deleted and the <em>keyrec</em> file handle is closed.  However,
modified data are not saved prior to closing the file handle.  Thus, modified
and new data will be lost.</p>
<p>
</p>
<h2><a name="keyrec_fullrec_keyrec_name_"><em>keyrec_fullrec(keyrec_name)</em></a></h2>
<p><em>keyrec_fullrec()</em> returns a reference to the <em>keyrec</em> specified in
<em>keyrec_name</em>.</p>
<p>
</p>
<h2><a name="keyrec_keyfields__"><em>keyrec_keyfields()</em></a></h2>
<p>This routine returns a list of the recognized fields for a key <em>keyrec</em>.</p>
<p>
</p>
<h2><a name="keyrec_names__"><em>keyrec_names()</em></a></h2>
<p>This routine returns a list of the <em>keyrec</em> names from the file.</p>
<p>
</p>
<h2><a name="keyrec_read_keyrec_file_"><em>keyrec_read(keyrec_file)</em></a></h2>
<p>This interface reads the specified <em>keyrec</em> file and parses it into a
<em>keyrec</em> hash table and a file contents array.  <em>keyrec_read()</em>
<strong>must</strong> be called prior to any of the other
<em>Net::DNS::SEC::Tools::keyrec</em> calls.  If another <em>keyrec</em> is
already open, then it is saved and closed prior to opening the new
<em>keyrec</em>.</p>
<p>Upon success, <em>keyrec_read()</em> returns the number of <em>keyrec</em>s read from the
file.</p>
<p>Failure return values:</p>
<pre>
    -1 specified I&lt;keyrec&gt; file doesn't exit</pre>
<pre>
    -2 unable to open I&lt;keyrec&gt; file</pre>
<pre>
    -3 duplicate I&lt;keyrec&gt; names in file</pre>
<p>
</p>
<h2><a name="keyrec_recval_keyrec_name_keyrec_field_"><em>keyrec_recval(keyrec_name,keyrec_field)</em></a></h2>
<p>This routine returns the value of a specified field in a given <em>keyrec</em>.
<em>keyrec_name</em> is the name of the particular <em>keyrec</em> to consult.
<em>keyrec_field</em> is the field name within that <em>keyrec</em>.</p>
<p>For example, the current <em>keyrec</em> file contains the following <em>keyrec</em>.</p>
<pre>
    zone        &quot;portrigh.com&quot;
                zonefile        &quot;db.portrigh.com&quot;</pre>
<p>The call:</p>
<pre>
    keyrec_recval(&quot;portrigh.com&quot;,&quot;zonefile&quot;)</pre>
<p>will return the value ``db.portrigh.com''.</p>
<p>
</p>
<h2><a name="keyrec_setval_keyrec_type_keyrec_name_field_value_"><em>keyrec_setval(keyrec_type,keyrec_name,field,value)</em></a></h2>
<p>Set the value of a name/field pair in a specified <em>keyrec</em>.  The file is
<strong>not</strong> written after updating the value.  The value is saved in both
<em>%keyrecs</em> and in <em>@keyreclines</em>, and the file-modified flag is set.</p>
<p><em>keyrec_type</em> specifies the type of the <em>keyrec</em>.  This is only used if a
new <em>keyrec</em> is being created by this call.
<em>keyrec_name</em> is the name of the <em>keyrec</em> that will be modified.
<em>field</em> is the <em>keyrec</em> field which will be modified.
<em>value</em> is the new value for the field.</p>
<p>Return values are:</p>
<pre>
    0 if the creation succeeded</pre>
<pre>
    -1 invalid type was given</pre>
<p>
</p>
<h2><a name="keyrec_write__"><em>keyrec_write()</em></a></h2>
<p>This interface saves the internal version of the <em>keyrec</em> file (opened with
<em>keyrec_read()</em>).  It does not close the file handle.  As an efficiency
measure, an internal modification flag is checked prior to writing the file.
If the program has not modified the contents of the <em>keyrec</em> file, it is not
rewritten.</p>
<p>
</p>
<h2><a name="keyrec_zonefields__"><em>keyrec_zonefields()</em></a></h2>
<p>This routine returns a list of the recognized fields for a zone <em>keyrec</em>.</p>
<p>
</p>
<hr />
<h1><a name="keyrec_internal_interfaces">KEYREC INTERNAL INTERFACES</a></h1>
<p>The interfaces described in this section are intended for internal use by the
<em>Net::DNS::SEC::Tools::keyrec</em> module.  However, there are situations where external
entities may have need of them.  Use with caution, as misuse may result in
damaged or lost <em>keyrec</em> files.</p>
<p>
</p>
<h2><a name="keyrec_init__"><em>keyrec_init()</em></a></h2>
<p>This routine initializes the internal <em>keyrec</em> data.  Pending changes will
be lost.  An open <em>keyrec</em> file handle will remain open, though the data are
no longer held internally.  A new <em>keyrec</em> file must be read in order to use
the <em>Net::DNS::SEC::Tools::keyrec</em> interfaces again.</p>
<p>
</p>
<h2><a name="keyrec_newkeyrec_kr_name_kr_type_"><em>keyrec_newkeyrec(kr_name,kr_type)</em></a></h2>
<p>This interface creates a new <em>keyrec</em>.  The <em>keyrec_name</em> and <em>keyrec_hash</em>
fields in the <em>keyrec</em> are set to the values of the <em>kr_name</em> and <em>kr_type</em>
parameters.  <em>kr_type</em> must be either ``key'' or ``zone''.</p>
<p>Return values are:</p>
<pre>
    0 if the creation succeeded</pre>
<pre>
    -1 if an invalid I&lt;keyrec&gt; type was given</pre>
<p>
</p>
<hr />
<h1><a name="keyrec_debugging_interfaces">KEYREC DEBUGGING INTERFACES</a></h1>
<p>The following interfaces display information about the currently parsed
<em>keyrec</em> file.  They are intended to be used for debugging and testing, but
may be useful at other times.</p>
<p>
</p>
<h2><a name="keyrec_dump_hash__"><em>keyrec_dump_hash()</em></a></h2>
<p>This routine prints the <em>keyrec</em> file as it is stored internally in a hash
table.  The <em>keyrec</em>s are printed in alphabetical order, with the fields
alphabetized for each <em>keyrec</em>.  New <em>keyrec</em>s and <em>keyrec</em> fields are
alphabetized along with current <em>keyrec</em>s and fields.  Comments from the
<em>keyrec</em> file are not included with the hash table.</p>
<p>
</p>
<h2><a name="keyrec_dump_array__"><em>keyrec_dump_array()</em></a></h2>
<p>This routine prints the <em>keyrec</em> file as it is stored internally in
an array.  The <em>keyrec</em>s are printed in the order given in the file,
with the fields ordered in the same manner.  New <em>keyrec</em>s are
appended to the end of the array.  <em>keyrec</em> fields added to existing
<em>keyrec</em>s are added at the beginning of the <em>keyrec</em> entry.
Comments and vertical whitespace are preserved as given in the
<em>keyrec</em> file.</p>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Wayne Morrison, <a href="mailto:tewok@users.sourceforge.net">tewok@users.sourceforge.net</a></p>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p>Net::DNS::SEC::Tools::keyrec(5)</p>

</body>

</html>
